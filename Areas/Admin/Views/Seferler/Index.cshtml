@* Model olarak Sefer listesi bekleniyor *@
@model IEnumerable<BusTicket.Models.Entities.Sefer>
@using BusTicket.Models 

@{
    // Sayfa başlığını ayarla
    ViewData["Title"] = "Sefer Arama";
    // Arama yapılıp yapılmadığını kontrol etmek için (boş form ile sonuç yok mesajını ayırmak için)
    bool aramaYapildi = !string.IsNullOrEmpty(ViewData["KalkisSehri"] as string) || !string.IsNullOrEmpty(ViewData["VarisSehri"] as string);
}

<h1>@ViewData["Title"]</h1>

<hr />

@* Sefer Arama Formu *@
<div class="row">
    <div class="col-md-8">
        <form asp-action="Index" method="get"> @* GET metodu ile form gönderilecek *@
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="kalkisSehri" class="form-label">Kalkış Şehri</label>
                    @* ViewData ile önceki arama değerini input'a yazdırıyoruz *@
                    <input type="text" id="kalkisSehri" name="kalkisSehri" value="@(ViewData["KalkisSehri"] as string)" class="form-control" placeholder="Örn: Ankara" />
                </div>
                <div class="col-md-4 mb-3">
                    <label for="varisSehri" class="form-label">Varış Şehri</label>
                    @* ViewData ile önceki arama değerini input'a yazdırıyoruz *@
                    <input type="text" id="varisSehri" name="varisSehri" value="@(ViewData["VarisSehri"] as string)" class="form-control" placeholder="Örn: İstanbul" />
                </div>
                <div class="col-md-4 mb-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Sefer Ara</button>
                </div>
            </div>
        </form>
    </div>
</div>

<hr />

@* Arama Sonuçları *@
<h2>Arama Sonuçları</h2>

@if (Model != null && Model.Any()) @* Eğer model boş değilse ve içinde eleman varsa tabloyu göster *@
{
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Güzergah</th>
                <th>Otobüs Plakası</th>
                <th>Kalkış Zamanı</th>
                <th>Varış Zamanı</th>
                <th>Bilet Fiyatı</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @* İlişkili Güzergah null değilse göster, null ise "-" göster *@
                        @(item.Guzergah?.KalkisSehri ?? "-") - @(item.Guzergah?.VarisSehri ?? "-")
                    </td>
                    <td>
                        @* İlişkili Otobüs null değilse göster, null ise "-" göster *@
                        @(item.Otobus?.Plaka ?? "-")
                    </td>
                    <td>
                        @* Tarih/Saat formatını ayarla (Örnek: 07.04.2025 10:30) *@
                        @item.KalkisZamani.ToString("g")
                    </td>
                    <td>
                        @item.VarisZamani.ToString("g")
                    </td>
                    <td>
                        @* Fiyat formatını para birimi olarak ayarla *@
                        @item.BiletFiyati.ToString("C")
                    </td>
                    <td>
                        @* Detay sayfasına link *@
                        <a asp-action="Detay" asp-route-id="@item.SeferID" class="btn btn-sm btn-info">Detaylar</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else if (aramaYapildi) @* Eğer arama yapıldıysa ama sonuç yoksa *@
{
    <div class="alert alert-warning" role="alert">
        Aradığınız kriterlere uygun sefer bulunamadı.
    </div>
}
else @* Henüz arama yapılmadıysa (sayfa ilk açıldığında) *@
{
     <div class="alert alert-info" role="alert">
        Lütfen kalkış ve varış şehirlerini seçerek sefer arayınız.
    </div>
}